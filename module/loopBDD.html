<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Map with Database Markers</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #map {
      height: 500px;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>Leaflet Map with Database Markers</h1>
  <div id="map"></div>

  <script>
    var map;
    fetch('http://192.168.64.210:3000/markers')
    .then((response) => {
      return response.json();
    })
    .then((data) => {

      //map = L.map('map').setView([marker.latitude, marker.longitude], 13);
      map = L.map('map').setView([data[0].latitude, data[0].longitude], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      //console.log(data);
/*
      data.forEach(function(coord, index) {
      {
          L.marker([(coord.latitude), (coord.longitude)]).addTo(map)
        .bindPopup('A pretty CSS popup.<br> Easily customizable.')
        //.openPopup();
      }
      
      //let markers = data;
      })
*/
console.log(data[0]);

let latitude = data[0].latitude;
let longitude = data[0].longitude;

console.log(latitude);

// Créer le marqueur initial
let marker = L.marker([latitude, longitude]).addTo(map)
  .bindPopup('A pretty CSS popup.<br> Easily customizable.');

// Fonction pour ajuster la latitude après une minute
function ajusterLatitude() {
  latitude ++;
  marker.setLatLng([latitude, longitude]);
  console.log(latitude)
  
}

// Appeler la fonction `ajusterLatitude` après une minute
setInterval(ajusterLatitude, 3000); // 60000 ms = 1 minute


    //.catch(function(error) {
    //  console.log(error);
    //})
  });


/*
    var marker = {
        "latitude": 49.5100,
        "longitude": 2.4385
    };
*/

    // Utiliser fetch pour obtenir les données de l'API
    fetch('http://192.168.64.210:3000/markers')
      .then(response => {
        if (!response.ok) {
          throw new Error('Erreur HTTP, statut ' + response.status);
        }
        return response.json();
      })
      .catch(error => {
        console.error('Erreur lors de la récupération des données:', error);
      });


  </script>
</body>
</html>
